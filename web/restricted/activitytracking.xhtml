<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/WEB-INF/pageTemplate.xhtml"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    
    <ui:define name="title">Activity Tracking</ui:define>
    <ui:param name="link" value="#{msg['act-track']}"/>
    <ui:define name="content">
        <h:form id="actForm">
            <p:panel header="Select User ID to view the activities of the user">
                <h:panelGrid id="uapanel" columns="2" cellpadding="5" cellspacing="5">
                    <p:selectOneMenu id="userID" value="#{actiBean.trackUser}">
                        <f:selectItem itemLabel="Select User ID" itemValue=""/>
                        <f:selectItems value="#{actiBean.userIDHash}"/>
                        <p:ajax update="useracti uapanel" 
                                listener="#{actiBean.trackUserChange()}"/>
                    </p:selectOneMenu>
                    <p:commandButton rendered="#{actiBean.userSelectedStatus}" 
                                     value="Export as Excel" ajax="false">
                        <p:dataExporter type="xls" target="actitable" 
                                        fileName="UserActivities"/>
                    </p:commandButton>
                </h:panelGrid>
            </p:panel>
            <p:panel id="useracti" visible="#{actiBean.userSelectedStatus}">
                <p:dataTable id="actitable" rows="10"
                             rendered="#{actiBean.userSelectedStatus}" 
                             var="uacti" value="#{actiBean.userActivities}" 
                             paginator="true" paginatorTemplate="{RowsPerPageDropdown} 
                             {FirstPageLink} {PreviousPageLink} {CurrentPageReport} 
                             {NextPageLink} {LastPageLink}"
                             rowsPerPageTemplate="10,15,20"
                             styleClass="table-odd-row table-even-row">
                    <f:facet name="header">
                        <h:outputText value="#{actiBean.trackUser}"/>
                    </f:facet>
                    <p:column headerText="Date and Time" sortBy="#{uacti.now}" 
                              style="width: 200px">
                        <h:outputText value="#{uacti.timeString}"/>
                    </p:column>
                    <p:column headerText="Action" sortBy="#{uacti.activity}" 
                              style="width: 120px">
                        <h:outputText value="#{uacti.activity}"/>
                    </p:column>
                    <p:column headerText="Result or Target">
                        <h:outputText value="#{uacti.detail}"/>
                    </p:column>
                </p:dataTable>
            </p:panel>
            
            <p:panel header="Select activity to view activity log">
                <h:panelGrid id="logpanel" columns="2" cellpadding="5" cellspacing="5">
                    <p:selectOneMenu id="activity" value="#{actiBean.trackActi}">
                        <f:selectItem itemLabel="Select Activity" itemValue=""/>
                        <f:selectItems value="#{menuBean.activityList}"/>
                        <p:ajax update="actilog logpanel" 
                                listener="#{actiBean.trackActiChange()}"/>
                    </p:selectOneMenu>
                    <p:commandButton rendered="#{actiBean.actiSelectedStatus}" 
                                     value="Export as Excel" ajax="false">
                        <p:dataExporter type="xls" target="logtable" 
                                        fileName="ActivityLog"/>
                    </p:commandButton>
                    
                </h:panelGrid>
            </p:panel>
            <p:panel id="actilog" visible="#{actiBean.actiSelectedStatus}">
                <p:dataTable id="logtable" rows="10" 
                             rendered="#{actiBean.actiSelectedStatus}" 
                             var="alog" value="#{actiBean.actiLog}"
                             paginator="true" paginatorTemplate="{RowsPerPageDropdown} 
                             {FirstPageLink} {PreviousPageLink} {CurrentPageReport} 
                             {NextPageLink} {LastPageLink}"
                             rowsPerPageTemplate="10,15,20"
                             styleClass="table-odd-row table-even-row">
                    <f:facet name="header">
                        <h:outputText value="#{actiBean.trackActi}"/>
                    </f:facet>
                    <p:column headerText="Date and Time" sortBy="#{alog.now}" 
                              style="width: 200px">
                        <h:outputText value="#{alog.timeString}"/>
                    </p:column>
                    <p:column headerText="User ID" sortBy="#{alog.user_id}" 
                              style="width: 120px">
                        <h:outputText value="#{alog.user_id}"/>
                    </p:column>
                    <p:column headerText="Result or Target">
                        <h:outputText value="#{alog.detail}"/>
                    </p:column>                    
                </p:dataTable>
            </p:panel>

        </h:form>
    </ui:define>
</ui:composition>